+++
date = '2025-09-16T21:23:31+09:00'
draft = true
title = '実行中の関数を止めるには'
categories= ['Programming']
tags= ['', '']
+++

**実行中の関数を途中で止めるにはどうすればいいのか？**

こんな API を想像してみましょう。ユーザーの質問を受け取り、まず LLM で意図を判定し、ベクトル化 API でベクトルに変換し、フルテキスト検索やベクトルデータベースから関連コンテンツを探し、外部 API で再ランクし、複雑なロジックで加工し、最終的にもう一度 LLM を呼び出して回答を生成します。

典型的な RAG の呼び出しで、単一の API の裏側には膨大な処理が隠れています。

1. 外部 API の呼び出し
2. 複数データベースへのアクセス
3. 複雑なアルゴリズム

ところがクライアントがリクエストした直後にキャンセルしたらどうなるでしょうか。

> キャンセルには以下が含まれます。
>
> 1. ユーザーが画面上の「質問をやめる」ボタンを押す
> 2. ユーザーがブラウザを閉じる

これまでは「特に何もしない」ことがデフォルトの対応でした。しかし今回は、ユーザーがリクエストをキャンセルした瞬間にバックエンドの処理も止められないか、と考えました。そんなことは可能でしょうか？

もし「独立した実行単位が存在し、お互いにメモリもリソースも共有しない。軽量で生成・破棄が安価」という言語があれば理想的です。

そう、それが Elixir（正確には Erlang）です。

Go にもゴルーチンがあります。条件を満たせそうに見えますが、果たしてどうでしょうか。
